"use strict";function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();!function(){void 0===window.ff&&(window.ff={}),window.ff.config||(window.ff.config={}),window.ff.config.root="/views/",window.ff.config.ext=".mst",window.ff.state||!function(){window.ff.state={loaderIsActive:"true",loaderInError:"false"};var e=window.ff.state;e.showLoader=function(){e.loaderIsActive=!0,$(".ff-loader").addClass("ff-loader_show")},e.hideLoader=function(){e.loaderIsActive=!1,$(".ff-loader").removeClass("ff-loader_show")},e.errorLoader=function(r){e.loaderIsActive=!0,e.loaderInError=!1,$(".ff-loader").addClass("ff-loader_show").addClass("ff-loader_error").attr("data-error",r),setTimeout(function(){e.hideLoader(),e.loaderInError=!1,$(".ff-loader").removeClass("ff-loader_error").attr("data-error","")},1e4)}}(),ff.fastResolve=function(e){return $.Deferred().resolve(e).promise()},ff.fastReject=function(e){return $.Deferred().reject(e).promise()},ff.async=function(e,r,t){var n=$.Deferred();return setTimeout(function(){!!r&&r(t),n.resolve(t)},e),n.promise()};var e=[];ff.event={on:function(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.context,a=void 0===o?{}:o,i=n.order,f=void 0===i?1:i,u=n.bubble,l=void 0===u||u,c=n.label,s=n.once,d=void 0!==s&&s;if("string"!=typeof r)throw new Error("Event name must be string!");if("function"!=typeof t)throw new Error("Event callback must be function!");r in e||(e[r]=[]),e[r].push({callback:t,context:a,order:f,bubble:l,label:c,once:d})},off:function(r,t){if("string"!=typeof r)throw new Error("Event name must be string!");var n=e[r];return!(!n||!n.length)&&("string"==typeof t?(e[r]=n.filter(function(e){return e.label!==t}),!1):"function"!=typeof t?(delete e[r],!1):void(e[r]=n.filter(function(e){return e.callback!==t})))},trigger:function(r,t){if("string"!=typeof r)throw new Error("Event name must be string!");return r in e&&(e[r].sort(function(e,r){var t=e.order,n=r.order;return n-t}).some(function(e){return e.callback.call(e.context,t),e.once&&(e.toDelete=!0),!e.bubble}),void e[r].filter(function(e){return!e.toDelete}))}},ff.HashOfTree=function(){function e(r){_classCallCheck(this,e),this.name=r,this.length=0,this.hash=_defineProperty({},this.name+"_-1",{meta:this.name+"_-1",childrenArr:[],level:0})}return _createClass(e,[{key:"push",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=this.name+"_"+this.length++;return this.hash[t]={item:Object.assign({},e),parentMeta:r,meta:t,childrenArr:[],level:r?this.hash[r].level+1:1},r?this.hash[r].childrenArr.push(t):this.hash[this.name+"_-1"].childrenArr.push(t),t}},{key:"getRegistry",value:function(e){return this.hash[e]}},{key:"getParentRegistry",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=this.getRegistry(e);r<0&&(r=t.level+r);for(var n=1;n<=r&&t.level>1;n++)t=this.getRegistry(t.parentMeta);return t}},{key:"showRegistries",value:function(){console.log(this.hash)}},{key:"getNodeByMeta",value:function(e){var r=this.getRegistry(e);if(!r._node){var t=$("body").find('[data-ff="'+e+'"]');r._node=t}return r._node}},{key:"setNodeByMeta",value:function(e,r){var t=this.getRegistry(e);t._node=r}},{key:"getChildren",value:function(e){return void 0===e&&(e=this.name+"_-1"),this.hash[e].childrenArr}}]),e}()}(),function(e){var r={};void 0===window.ff&&(window.ff={}),void 0===window.ff.controller&&(window.ff.controller=function(){var e=function(e){return r[e]?{value:r[e].value,clearFunction:r[e].clearFunction||function(){}}:void console.error("Undefined controller "+e)},t=function(e,t,n){if("string"!=typeof e)throw new Error("Key of controller must be String!");r[e]={value:t,clearFunction:n}};return{get:e,set:t}}())}(jQuery);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var r;ff.router||(ff.router=function(){function t(r){if("/"===r)return a.filter(function(e){return"/"===e.name&&!e.hashParams})[0]||null;var t=e.router.getParameters(r||"");if(!t.length)return null;var n=t[0].route.route;return a.filter(function(e){var r,t=n===e.name,a=!1,i=!1;return"object"!==("undefined"==typeof n?"undefined":_typeof(n))||"object"!==e.name||e.hashParams||(a=n.source===e.name.source),e.hashParams&&"object"===("undefined"==typeof n?"undefined":_typeof(n))&&(r=o(e.name,e.hashParams),e.param?(r=new RegExp(r.source.replace(":"+e.param,".+")),i=r.source===n.source):i=r.source===n.source),t||a||i})[0]||null}function n(e,r){var t="object"===("undefined"==typeof e?"undefined":_typeof(e))||r?"regexp":"string",n=e;if(r)var n=o(e,r);var i=a.filter(function(e){return e.type===t&&"regexp"===t?e.name.source===n.source:e.name===n});return i[0]||null}function o(e,r){"string"==typeof r&&(r=[r]);var t="object"===e?e.source:e;return t.indexOf("^")===-1&&(t="^"+t),t+="/?#",r.forEach(function(e,r,n){r&&(t+="(?:&"),t+=(r?"":"(?:")+e+"=([^&]+))?",r===n.length-1&&(t+="$")}),new RegExp(t)}var a=[];return{add:function(r,t,i){var f=r,u=0;i||(i={});var l=n(f,i.hashParams),c=t;Array.isArray(t)&&(c=t[t.length-1]),l?(l.name=f,l.controller=t,l.title=i.title,l.hashParams=i.hashParams,l.param=i.param,l.type="object"===("undefined"==typeof f?"undefined":_typeof(f))?"regexp":"string"):a.push({name:f,controller:c,title:i.title,hashParams:i.hashParams,param:i.param,guardError:i.guardError,type:"object"===("undefined"==typeof f?"undefined":_typeof(f))?"regexp":"string"}),i.hashParams&&(f=o(f,i.hashParams),i.param&&"string"==typeof r&&(u=r.indexOf(":"),f=new RegExp(f.source.replace(":"+i.param,".+")))),e.router.add(f,i.param,function(r){r.hash={};var n=i.hashParams;n&&("string"==typeof n&&(n=[n]),n.forEach(function(e,t){r.hash[e]=r.matches[t+1]}),delete r.matches);var o,a=window.location.pathname+window.location.hash,f={};if(u>0&&(o=new RegExp("^.{"+u+"}([^/#]+)"),f=a.match(o),f[1]&&(r[i.param]=f[1])),Array.isArray(t)&&t.length>1){var l=t,c=l.slice(-1)[0],s=l.slice(0,-1).map(function(e){return e.value(r)});e.when.apply(null,s).then(function(){c.value(r)},function(e){if(i.guardError){if("function"!=typeof i.guardError)throw new Error('"guardError" in options of route must be a function');i.guardError(e)}})}else Array.isArray(t)&&1===t.length?t[0].value(r):Array.isArray(t)||t.value(r)})},go:function(n,o,a){var i=t(n);i?(o||(o=i.title),r&&r.controller&&"function"==typeof r.controller.clearFunction&&r.controller.clearFunction(n),r=i,o&&(document.title=o),e.router.go(n,o,!a)):console.error("Undefined route "+n)},updateLinks:function(r){var n=this.go,o=e(r);return o.find("a").filter(function(r,n){return!!t(e(n).attr("href"))&&"_blank"!==e(n).attr("target")&&"bind"!==e(n).attr("data-ff-route")}).attr("data-ff-route","bind").click(function(r){r.preventDefault(),n(e(this).attr("href"),t(e(this).attr("href")).title,!0)}),o}}}()),function(){var t,n=window.location.pathname;e._data(window,"events").popstate&&e._data(window,"events").popstate[0]&&(t=e._data(window,"events").popstate[0].handler,e._data(window,"events").popstate[0].handler=function(e){if(n===window.location.pathname)return e.preventDefault(),e.stopPropagation(),!1;t.apply(this,arguments);var o=window.location.pathname+window.location.hash;r&&r.controller&&"function"==typeof r.controller.clearFunction&&r.controller.clearFunction(o),ff.router.go(o)})}()}(jQuery),$(function(){var e=window.location.pathname+window.location.hash;e.length>1&&/(.+)\/$/.test(e)&&(e=e.slice(0,e.length-1)),ff.router.go(e),ff.router.updateLinks($("body"))});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var r={},t={};if(!window.Mustache)throw new Error("Mustache must be required for ff.view !");void 0===window.ff&&(window.ff={}),void 0===window.ff.view&&(window.ff.view=function(){function n(e,r,t){"function"==typeof r&&r(t),e.resolve(t)}function o(o){var a=e.Deferred(),i=window.ff.view.config;return t[o]?a=t[o]:r[o]?n(a,null,r[o]):(t[o]=a,e.get(i.root+o+i.ext).then(function(e){r[o]=e,n(a,null,e),t[o]=null,delete t[o]},function(e){console.error("Can't get view \""+o+'"'),console.error(e)})),a.promise()}return function r(t,a,i){var f,u=e.Deferred();return o(t).then(function(e){a&&"object"===("undefined"==typeof a?"undefined":_typeof(a))?(f=Mustache.render(e,a),"string"==typeof a.layout?r("layouts/"+a.layout).then(function(e){f=Mustache.render(e,a.dataLayout||{},{partialView:f}),n(u,i,f)}):n(u,i,f)):(f=e,n(u,i,f))}),u.promise()}}(),window.ff.view.config={root:"/views/",ext:".mst"})}(jQuery);
//# sourceMappingURL=core.js.map
